# 传送带异物检测及物料跑偏检测挑战赛
<div>
    <b>一、赛事背景</b><br>
    在工业场景中，对传送带上的异物检测以及传送带物料偏移检测是保证产品质量以及生产安全的一个重要的环节。但通常面临着异物种类繁多、异物样本不规则、异物目标小、部分异物种类样本少的问题。本赛题就是针对此类场景设置，在限定样本数量的情况下进行传送带安全检测，即对传送带异物以及传送带物料是否存在偏移进行检测识别，是一个极具挑战性的小目标检测任务。
</div>
<br>
<div>
    <b>二、赛事任务</b> <br>
    本次赛事针对钢铁生产企业物料传送皮带图片，参赛者需要完成如下要求：   <br>
    1）将皮带上是否有异物检测出来，并标记异物类别和位置;    <br>
    2）检测皮带上物料是否跑偏，给出检测结果。<br>
    
    输入/输出: <br>
    (1) 输入:一张图片，jpg格式 <br>
    (2) 输出:检测产品的异物类型，异物位置，物料跑偏检测结果。 <br>
</div>
<br>
 
<li>传送带异物检测及物料跑偏检测数据集</b><br>
<div>
数据集地址：https://challenge.xfyun.cn/topic/info?type=conveyor-belt&option=stsj <br>
数据集页面：
<img width="1011" alt="image" src="https://github.com/tgltt/conveyerbelt-detect/assets/36066270/21c82328-ad15-4d52-80f4-ed22b58f7d6a">
</div>
<br>
<br>
    
<li><b>工程结构说明</b><br>

|    文件/文件夹         |                   功能描述               |
|       ----            |                    ----                 |
| kaggle_jupyter        | 存放本工程运行在jupyter notebook的实现文件 |
| paper                 | 存放模型相关的论文(ResNet、SSD)           |
| res50+ssd             | 存放ResNet50预训练模型                   |
| save_weights          | 存放模型每个迭代训练完成后的模型参数       |
| test_img              | 存放测试模型用的图片和视频                |
| src                   | 存放SSD模改后的模型                      |
| train_utils           | 存放训练功能相关的文件                    |
| train_ssd300.py       | 训练模型的主函数及入口类                  |
| my_dataset.py         | 定义批量访问数据集的功能类                 |
| transforms.py         | 预处理图片的功能类                        |
| predict_test.py       | 验证模型的推理功能类, 只验证图片           |
| predict_test_video.py | 验证模型的推理功能类, 只验证视频           |
| calculate_dataset_mean_std.py | 计算训练集图像RGB三个通道的均值和方差, 由于军用飞行器数据集并非ImageNet、CoCo、Voc这类国际大型数据集，故数据集和标准差需自行计算 |
<br>
<br>

<li><b>环境配置</b><br>
<div>Pip 安装包含所有 requirements.txt 的包，环境要求 Python>=3.6，且 PyTorch>=1.7
此外，需安装Coco性能(mAP)评估工具，使用下面的命令:</div>
    
```bash
pip install pycocotools 
```
<br>
<br>  
    
<li><b>工程算法说明</b><br>
<div>
    本工程基于<b>多任务多尺度的物体检测框架SSD</b>，根据军用航空器数据集的特点，进行<b>算法模型改造</b>，涉及改造点为图片数据格式筛选、训练集/测试集数据划分、图像标签数据结构转换为COCO数据格式、学习率及学习率调度参数调整、根据军用飞行器数据集计算Normalization的均值及标准差等。<br>
</div>
    
<div align=center>
    <img width="737" alt="image" src="https://user-images.githubusercontent.com/36066270/219654243-874a721d-72c2-4a6b-a577-747701e9fa5d.png"><br>
    <img width="813" alt="image" src="https://user-images.githubusercontent.com/36066270/219656949-dd7f7981-2f2a-49ff-a6b2-553306c1c126.png"><br>
    <b>SSD原理图</b> 
</div>
<br>
<br>

<li><b>本工程运行效果</b><br>
    以下检测结果图片在本工程的test_img目录下，检测结果上方文字，左边表示航空器类型，右边表示检测结果置信度。<br><br>
    检测图片路径：<a href="test_img/7854921f5e41d063b65bca8b429b6aa8.jpg">test_img/7854921f5e41d063b65bca8b429b6aa8.jpg</a><br>
    <img width="521" alt="image" src="https://user-images.githubusercontent.com/36066270/219657506-67d3406f-ac83-4ccd-bc90-842f17be536b.png"><br><br>
    检测图片路径：<a href="test_img/02d408885ea1339fac6e2344086599ab.jpg">test_img/02d408885ea1339fac6e2344086599ab.jpg</a><br>
    <img width="787" alt="image" src="https://user-images.githubusercontent.com/36066270/219657823-e0d68fe0-12fa-41f8-9f8f-0513461433c5.png"><br><br>
    检测图片路径：<a href="test_img/00ebecac178be3c3890a067d6a28234e.jpg">test_img/00ebecac178be3c3890a067d6a28234e.jpg</a><br>
    <img width="465" alt="image" src="https://user-images.githubusercontent.com/36066270/219658699-75fd9c95-e053-4f01-ab6c-a99620e5db46.png"><br><br>

美国C130大力神运输机视频检测效果： <a href="test_img/video/C130_detect.mp4">test_img/video/C130_detect.mp4</a><br>
美国F35攻击机视频检测效果：<a href="test_img/video/F35_detect.mp4">test_img/video/F35_detect.mp4</a><br>

<li><b>模型性能(COCO评估)</b><br>
    数据集10, 000张图片, 8,000张用于训练，剩下2,000张图片用于测试和评估，采用GPU P100训练70小时, 总共经历250个迭代(epochs)，目前达到的性能Iou 0.50以上的mAP为64.1%。召回率为61.5%.<br><br>
    
<div align=center>
<b>模改后的算法模型性能指标(epochs=249)</b>

|          PR指标         |     IoU   |   area | maxDets| AP/AR取值 |
|          :-----         |   :----:  | :----: | :----: |  :----:  |
| Average Precision  (AP) | 0.50:0.95 |  all   |   100  |  0.497   |
| Average Precision  (AP) | 0.50      |  all   |   100  |  0.641   |
| Average Precision  (AP) | 0.75      |  all   |   100  |  0.571   |
| Average Precision  (AP) | 0.50:0.95 |  small |   100  |  0.160   |
| Average Precision  (AP) | 0.50:0.95 | medium |   100  |  0.238   |
| Average Precision  (AP) | 0.50:0.95 | large  |   100  |  0.535   |
| Average Recall     (AR) | 0.50:0.95 |  all   |   1    |  0.499   |
| Average Recall     (AR) | 0.50:0.95 |  all   |   10   |  0.615   |
| Average Recall     (AR) | 0.50:0.95 |  all   |   100  |  0.615   |
| Average Recall     (AR) | 0.50:0.95 |  small |   100  |  0.183   |
| Average Recall     (AR) | 0.50:0.95 | medium |   100  |  0.314   |
| Average Recall     (AR) | 0.50:0.95 | large  |   100  |  0.655   |
</div>
    
<br>
<div>

![image](https://user-images.githubusercontent.com/36066270/219755281-e56bede1-f4f4-46da-8c04-a1fc67d698e8.png)
</div>
    
<div align=center>
    
|     epoch  |     AP    |     AR    |      Loss     |
|    :----:  |    ----   |    ----   |      ----     |
|      1     |   0.000   |    0.000  |      22.3360  |
|      2     |   0.007 	 |    0.041  |      7.3388   |
|      3     |   0.010 	 |    0.060  |      6.3368   | 
|      4     |   0.013 	 |    0.074  |      6.1155   | 
|      5     |   0.018 	 |    0.076  |      5.9480   | 
|      6     |   0.025 	 |    0.097  | 	    5.8036   | 
|      7     |   0.030 	 |    0.115  |  	5.6972   | 
|      8     |   0.042 	 |    0.141  |  	5.5904   | 
|      9     |   0.055 	 |    0.179  |  	5.4466   | 
|     10     |   0.053 	 |    0.179  |  	5.3230   | 
|     11     |   0.077 	 |    0.221  |  	5.2228   | 
|     12     |   0.076 	 |    0.229  |  	5.0855   | 
|     13     |   0.106 	 |    0.252  |  	4.9378   | 
|     14     |   0.116 	 |    0.283  |  	4.8286   | 
|     15     |   0.098 	 |    0.275  |  	4.7319   | 
|     16     |   0.115 	 |    0.292  |  	4.6728   | 
|     17     |   0.135 	 |    0.303  |  	4.5767   | 
|     18     |   0.160 	 |    0.362  |  	4.4901   | 
|     19     |   0.133 	 |    0.301  |  	4.4454   | 
|     20     |   0.173 	 |    0.368  |  	4.3901   | 
|     21     |   0.194 	 |    0.370  |  	4.2980   | 
|     22     |   0.216 	 |    0.403  |  	4.1712   | 
|     23     |   0.212 	 |    0.386  |  	4.0861   | 
|     24     |   0.225 	 |    0.401  |  	4.0219   | 
|     25     |   0.216 	 |    0.399  |  	3.9458   | 
|     26     |   0.224 	 |    0.402  |  	3.9482   | 
|     27     |   0.249 	 |    0.417  |  	3.8746   | 
|     28     |   0.251 	 |    0.407  |  	3.8410   | 
|     29     |   0.223 	 |    0.358  |  	3.7824   | 
|     30     |   0.273 	 |    0.434  |  	3.7487   | 
|     31     |   0.269 	 |    0.426  |  	3.7072   | 
|     32     |   0.291 	 |    0.439  |  	3.5648   | 
|     33     |   0.322 	 |    0.453  |  	3.5148   | 
|     34     |   0.319 	 |    0.448  |  	3.4724   | 
|     35     |   0.325 	 |    0.471  |  	3.4321   | 
|     36     |   0.347 	 |    0.460  |  	3.3535   | 
|     37     |   0.304 	 |    0.438  |   	3.3818   |
|     38     |   0.315 	 |    0.441  |  	3.3182   |
|     39     |   0.334 	 |    0.451  |  	3.2920   |
|     40     |   0.329 	 |    0.448  |  	3.3047   |
|     41     |   0.344 	 |    0.456  |  	3.2501   |
|     42     |   0.336 	 |    0.446  |  	3.1107   |
|     43     |   0.362 	 |    0.467  |  	3.0606   |
|     44     |   0.370 	 |    0.470  |  	3.0867   |
|     45     |   0.371 	 |    0.467  |  	2.9950   |
|     46     |   0.374 	 |    0.452  |  	3.0097   |
|     47     |   0.381 	 |    0.471  |  	2.9660   |
|     48     |   0.385 	 |    0.486  |  	2.9802   |
|     49     |   0.387 	 |    0.475  |  	2.9341   |
|     50     |   0.397 	 |    0.482  |  	2.9761   |
|     51     |   0.397 	 |    0.477  |  	2.9828   |
|     52     |   0.416 	 |    0.416  |  	2.8721   |
|     53     |   0.410 	 |    0.492  |  	2.8087   |
|     54     |   0.405 	 |    0.483  |  	2.7852   |
|     55     |   0.433 	 |    0.503  |  	2.7267   |
|     56     |   0.426 	 |    0.509  |  	2.7400   |
|     57     |   0.423 	 |    0.501  |  	2.7273   |
|     58     |   0.434 	 |    0.499  |  	2.6924   |
|     59     |   0.455 	 |    0.508  |  	2.6684   |
|     60     |   0.423 	 |    0.491  |  	2.5809   |
|     61     |   0.448 	 |    0.504  |  	2.5990   |
|     62     |   0.472 	 |    0.522  |  	2.4780   |
|     63     |   0.467 	 |    0.525  |  	2.4771   |
|     64     |   0.477 	 |    0.520  |  	2.4363   |
|     65     |   0.475 	 |    0.524  |  	2.4238   |
|     66     |   0.449 	 |    0.501  |  	2.4348   |
|     67     |   0.458 	 |    0.508  |  	2.4215   |
|     68     |   0.490   |    0.528  |  	2.4010   |
|     69     |   0.473 	 |    0.522  |  	2.4000   |
|     70     |   0.477 	 |    0.507  |  	2.3705   |
|     71     |   0.502 	 |    0.527  |  	2.2468   |
|     72     |   0.490 	 |    0.513  |  	2.2056   |
|     73     |   0.482 	 |    0.535  |  	2.2971   |
|     74     |   0.469 	 |    0.513  |  	2.2507   |
|     75     |   0.501 	 |    0.529  |  	2.1906   |
|     76     |   0.498 	 |    0.533  |  	2.1586   |
|     77     |   0.510 	 |    0.541  |  	2.1520   |
|     78     |   0.493 	 |    0.521  |  	2.1857   |
|     79     |   0.482 	 |    0.517  |  	2.1437   |
|     80     |   0.497 	 |    0.522  |  	2.1239   |
|     81     |   0.484 	 |    0.521  |  	2.0711   |
|     82     |   0.498 	 |    0.516  |  	2.0594   |
|     83     |   0.508 	 |    0.545  |  	2.0119   |
|     84     |   0.526 	 |    0.550  |  	2.0249   |
|     85     |   0.532 	 |    0.542  |  	1.9981   |
|     86     |   0.521 	 |    0.538  |  	2.0065   |
|     87     |   0.516 	 |    0.528  |  	1.9920   |
|     88     |   0.512 	 |    0.542  |  	1.9728   |
|     89    |   0.518 	 |    0.536  |  	1.9606   |
|     90     |   0.525 	 |    0.546  |  	1.8959   |
|     91     |   0.535 	 |    0.551  |  	1.8099   |
|     92     |   0.541 	 |    0.549  |  	1.8468   |
|     93     |   0.537 	 |    0.549  |  	1.8957   |
|     94     |   0.523 	 |    0.537  |  	1.8400   |
|     95     |   0.538 	 |    0.555  |  	1.8266   |
|     96     |   0.544 	 |    0.562  |  	1.8403   |
|     97     |   0.537 	 |    0.545  |  	1.8071   |
|     98     |   0.523 	 |    0.545  |  	1.8118   |
|     99     |   0.527 	 |    0.535  |  	1.7983   |
|    100     |   0.548 	 |    0.554  |  	1.6962   |
|    101     |   0.537 	 |    0.552  |  	1.6623   |
|    102     |   0.548 	 |    0.556  |  	1.6971   |
|    103     |   0.555 	 |    0.569  |  	1.6833   |
|    104     |   0.541 	 |    0.541  |  	1.6800   |
|    105     |   0.519 	 |    0.530  |  	1.6849   |
|    106     |   0.550 	 |    0.552  |  	1.6812   |
|    107     |   0.551 	 |    0.551  |  	1.7132   |
|    108     |   0.516 	 |    0.536  |  	1.6426   |
|    109     |   0.547 	 |    0.554  |  	1.6688   |
|    110     |   0.549 	 |    0.553  |  	1.6144   |
|    111     |   0.551 	 |    0.564  |  	1.6127   |
|    112     |   0.564 	 |    0.567  |  	1.5438   |
|    113     |   0.569 	 |    0.574  |  	1.5946   |
|    114     |   0.563 	 |    0.557  |  	1.5255   |
|    115     |   0.541 	 |    0.548  |  	1.5691   |
|    116     |   0.572 	 |    0.573  |  	1.5922   |
|    117     |   0.562 	 |    0.552  |  	1.5631   |
|    118     |   0.554 	 |    0.558  |  	1.5586   |
|    119     |   0.533 	 |    0.545  |  	1.5450   |
|    120     |   0.572 	 |    0.570  |  	1.4835   |
|    121     |   0.546 	 |    0.547  |  	1.4839   |
|    122     |   0.572 	 |    0.566  |  	1.4681   |
|    123     |   0.575 	 |    0.561  |  	1.4736   |
|    124     |   0.581 	 |    0.581  |  	1.4397   |
|    125     |   0.569 	 |    0.571  |  	1.4571   |
|    126     |   0.582 	 |    0.581  |  	1.4096   |
|    127     |   0.575 	 |    0.579  |  	1.4436   |
|    128     |   0.570 	 |    0.577  |  	1.4552   |
|    129     |   0.577 	 |    0.561  |  	1.4403   |
|    130     |   0.594 	 |    0.583  |  	1.3993   |
|    131     |   0.591 	 |    0.577  |  	1.3537   |
|    132     |   0.591 	 |    0.583  |  	1.3686   |
|    133     |   0.576 	 |    0.570  |  	1.3563   |
|    134     |   0.575 	 |    0.567  |  	1.3627   |
|    135     |   0.570 	 |    0.567  |  	1.3698   |
|    136     |   0.575 	 |    0.566  |  	1.3435   |
|    137     |   0.582 	 |    0.573  |  	1.3564   |
|    138     |   0.576 	 |    0.570  |  	1.3776   |
|    139     |   0.586 	 |    0.579  |  	1.3496   |
|    140     |   0.588 	 |    0.581  |  	1.2943   |
|    141     |   0.591 	 |    0.575  |  	1.2628   |
|    142     |   0.592 	 |    0.577  |  	1.2774   |
|    143     |   0.591 	 |    0.572  |  	1.2672   |
|    144     |   0.595 	 |    0.582  |  	1.2900   |
|    145     |   0.577 	 |    0.568  |  	1.3301   |
|    146     |   0.592 	 |    0.583  |  	1.2893   |
|    147     |   0.579 	 |    0.573  |  	1.2832   |
|    148     |   0.596 	 |    0.576  |  	1.2470   |
|    149     |   0.602 	 |    0.590  |  	1.2468   |
|    150     |   0.595 	 |    0.582  |  	1.2234   |
|    151     |   0.595 	 |    0.584  |  	1.1840   |
|    152     |   0.582 	 |    0.575  |  	1.2137   |
|    153     |   0.591 	 |    0.575  |  	1.2059   |
|    154     |   0.602 	 |    0.590  |  	1.1998   |
|    155     |   0.584 	 |    0.564  |  	1.1921   |
|    156     |   0.583 	 |    0.568  |  	1.2085   |
|    157     |   0.595 	 |    0.580  |  	1.2248   |
|    158     |   0.594 	 |    0.574  |  	1.2242   |
|    159     |   0.609 	 |    0.589  |  	1.1591   |
|    160     |   0.610 	 |    0.593  |  	1.1328   |
|    161     |   0.600 	 |    0.584  |  	1.1117   |
|    162     |   0.607 	 |    0.592  |  	1.1709   |
|    163     |   0.616 	 |    0.595  |  	1.1515   |
|    164     |   0.610 	 |    0.589  |  	1.1743   |
|    165     |   0.615 	 |    0.590  |  	1.1519   |
|    166     |   0.611 	 |    0.581  |  	1.1551   |
|    167     |   0.622 	 |    0.600  |  	1.1566   |
|    168     |   0.609 	 |    0.592  |  	1.1528   |
|    169     |   0.616 	 |    0.601  |  	1.1155   |
|    170     |   0.626 	 |    0.605  |  	1.0941   |
|    171     |   0.603 	 |    0.579  |  	1.1288   |
|    172     |   0.611 	 |    0.598  |  	1.0802   |
|    173     |   0.619 	 |    0.598  |  	1.0880   |
|    174     |   0.611 	 |    0.591  |  	1.0796   |
|    175     |   0.615 	 |    0.600  |  	1.0830   |
|    176     |   0.615 	 |    0.588  |  	1.0637   |
|    177     |   0.605 	 |    0.585  |  	1.0658   |
|    178     |   0.610 	 |    0.592  |  	1.0967   |
|    179     |   0.619 	 |    0.600  |  	1.0275   |
|    180     |   0.610 	 |    0.581  |  	1.0442   |
|    181     |   0.618 	 |    0.591  |  	1.0262   |
|    182     |   0.622 	 |    0.601  |  	1.0654   |
|    183     |   0.619 	 |    0.589  |  	1.0159   |
|    184     |   0.617 	 |    0.593  |  	1.0343   |
|    185     |   0.613 	 |    0.598  |  	1.0359   |
|    186     |   0.630 	 |    0.605  |  	0.9935   |
|    187     |   0.623 	 |    0.599  |  	1.0134   |
|    188     |   0.617 	 |    0.594  |  	1.0097   |
|    189     |   0.636 	 |    0.607  |  	0.9957   |
|    190     |   0.623 	 |    0.595  |  	0.9875   |
|    191     |   0.624 	 |    0.604  |  	0.9908   |
|    192     |   0.629 	 |    0.603  |  	1.0112   |
|    193     |   0.643 	 |    0.616  |  	0.9590   |
|    194     |   0.618 	 |    0.599  |  	0.9734   |
|    195     |   0.631 	 |    0.604  |  	0.9769   |
|    196     |   0.625 	 |    0.603  |  	0.9683   |
|    197     |   0.628 	 |    0.601  |  	0.9873   |
|    198     |   0.621 	 |    0.596  |  	0.9871   |
|    199     |   0.634 	 |    0.608  |  	0.9605   |
|    200     |   0.636 	 |    0.611  |  	0.9582   |
|    201     |   0.640 	 |    0.609  |  	0.9443   |
|    202     |   0.632 	 |    0.602  |  	0.9411   |
|    203     |   0.629 	 |    0.603  |  	0.9287   |
|    204     |   0.631 	 |    0.606  |  	0.9491   |
|    205     |   0.619 	 |    0.596  |  	0.9353   |
|    206     |   0.641 	 |    0.609  |  	0.9450   |
|    207     |   0.624 	 |    0.597  |  	0.9459   |
|    208     |   0.638 	 |    0.612  |  	0.9342   |
|    209     |   0.632 	 |    0.607  |  	0.9060   |
|    210     |   0.635 	 |    0.607  |  	0.9109   |
|    211     |   0.626 	 |    0.602  |  	0.9031   |
|    212     |   0.624 	 |    0.597  |  	0.9246   |
|    213     |   0.628 	 |    0.607  |  	0.8916   |
|    214     |   0.626 	 |    0.604  |  	0.9106   |
|    215     |   0.633 	 |    0.612  |  	0.9320   |
|    216     |   0.638 	 |    0.612  |  	0.8970   |
|    217     |   0.630 	 |    0.600  |  	0.9091   |
|    218     |   0.633 	 |    0.604  |  	0.8963   |
|    219     |   0.633 	 |    0.605  |  	0.8824   |
|    220     |   0.643 	 |    0.611  |  	0.8681   |
|    221     |   0.630 	 |    0.602  |  	0.8988   |
|    222     |   0.631 	 |    0.605  |  	0.8579   |
|    223     |   0.627 	 |    0.599  |  	0.8763   |
|    224     |   0.632 	 |    0.607  |  	0.8718   |
|    225     |   0.635 	 |    0.607  |  	0.8860   |
|    226     |   0.640 	 |    0.613  |  	0.8736   |
|    227     |   0.632 	 |    0.608  |  	0.8689   |
|    228     |   0.639 	 |    0.613  |  	0.8636   |
|    229     |   0.635 	 |    0.610  |  	0.8604   |
|    230     |   0.641 	 |    0.612  |  	0.8418   |
|    231     |   0.639 	 |    0.613  |  	0.8475   |
|    232     |   0.632 	 |    0.614  |  	0.8484   |
|    233     |   0.637 	 |    0.612  |  	0.8381   |
|    234     |   0.640 	 |    0.621  |  	0.8384   |
|    235     |   0.639 	 |    0.613  |  	0.8253   |
|    236     |   0.641 	 |    0.616  |  	0.8487   |
|    237     |   0.641 	 |    0.622  |  	0.8479   |
|    238     |   0.637 	 |    0.613  |  	0.8534   |
|    239     |   0.635 	 |    0.612  |  	0.8327   |
|    240     |   0.644 	 |    0.616  |  	0.8057   |
|    241     |   0.638 	 |    0.613  |  	0.8144   |
|    242     |   0.634 	 |    0.614  |  	0.8122   |
|    243     |   0.641 	 |    0.614  |  	0.8059   |
|    244     |   0.632 	 |    0.612  |  	0.8026   |
|    245     |   0.632 	 |    0.606  |  	0.8355   |
|    246     |   0.641 	 |    0.612  |  	0.8056   |
|    247     |   0.641 	 |    0.615  |  	0.8242   |
|    248     |   0.635 	 |    0.613  |  	0.8214   |
  
</div>

<br><br>
<li><b>展望</b><br>
本工程对小物体(100*100以内)检测效果不太佳，另外对极相似的机型检测效果还不太稳定，比如F15、F35、J20、Mig31的检测效果比较摇摆，后续需对此两点进一步性能优化。
